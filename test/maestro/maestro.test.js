"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Maestro_1 = require("../../dist/maestro/Maestro");
const chai_1 = require("chai");
const Container_1 = require("../../dist/container/Container");
const Controller_1 = require("../../dist/controller/Controller");
const MockedAdapter_1 = require("../mock/adapter/MockedAdapter");
describe('Maestro', () => {
    let maestro;
    let controller;
    let container;
    beforeEach(() => {
        maestro = new Maestro_1.Maestro();
        container = new class extends Container_1.Container {
            constructor() {
                super(...arguments);
                this.baseURL = '';
            }
        };
        controller = new class extends Controller_1.Controller {
            constructor() {
                super(...arguments);
                this.baseURL = '';
            }
        };
    });
    it('Is created empty', () => {
        chai_1.expect(maestro.allRoutes().length).eq(0);
        chai_1.expect(maestro.containers().length).eq(0);
        chai_1.expect(maestro.controllers().length).eq(0);
    });
    it('Add containers', () => {
        maestro.add(container);
        chai_1.expect(maestro.containers().length).eq(1);
    });
    it('Remove containers', () => {
        maestro.add(container);
        chai_1.expect(maestro.containers().length).eq(1);
        maestro.removeChildContainer(container);
        chai_1.expect(maestro.containers().length).eq(0);
    });
    it('Add controllers', () => {
        maestro.add(controller);
        chai_1.expect(maestro.controllers().length).eq(1);
    });
    it('Remove controllers', () => {
        maestro.add(controller);
        chai_1.expect(maestro.controllers().length).eq(1);
        maestro.removeController(controller);
        chai_1.expect(maestro.controllers().length).eq(0);
    });
    it('Add adapters', () => {
        const adapter = new MockedAdapter_1.MockedAdapter;
        maestro.addAdapter(adapter);
        chai_1.expect(Object.values(maestro.adapters).length).eq(1);
    });
    it('Remove adapters', () => {
        const adapter = new MockedAdapter_1.MockedAdapter;
        maestro.addAdapter(adapter);
        chai_1.expect(Object.values(maestro.adapters).length).eq(1);
        delete maestro.adapters[adapter.name];
        chai_1.expect(Object.values(maestro.adapters).length).eq(0);
    });
    it('Inherit routes from container', () => {
        controller.resolve = () => { };
        container.allRoutes = () => {
            const routes = [{
                    url: 'mock',
                    methods: 'get',
                    controller,
                    resolver: controller.resolve,
                    requestProxies: [],
                    responseProxies: []
                }];
            return routes;
        };
        maestro.use(container);
        chai_1.expect(maestro.allRoutes().length).eq(1);
    });
    it('Inherit routes from controller', () => {
        controller.resolve = () => { };
        controller.allRoutes = () => {
            const routes = [{
                    url: 'mock',
                    methods: 'get',
                    controller,
                    resolver: controller.resolve,
                    requestProxies: [],
                    responseProxies: []
                }];
            return routes;
        };
        // By inheriting from container
        it('indirectly from container', () => {
            container.addController(controller);
            maestro.use(container);
            chai_1.expect(maestro.allRoutes().length).eq(1);
            maestro.removeChildContainer(container);
            maestro.deleteCachedRoutes();
        });
        // By directling adding it
        it('directly adding to maestro', () => {
            chai_1.expect(maestro.allRoutes().length).eq(0);
            maestro.deleteCachedRoutes();
            maestro.use(controller);
            chai_1.expect(maestro.allRoutes().length).eq(1);
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFlc3Ryby50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFlc3Ryby50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsd0RBQXFEO0FBQ3JELCtCQUE4QjtBQUM5Qiw4REFBMkQ7QUFDM0QsaUVBQThEO0FBRTlELGlFQUE4RDtBQUc5RCxRQUFRLENBQUMsU0FBUyxFQUFFLEdBQUcsRUFBRTtJQUV2QixJQUFJLE9BQWdCLENBQUM7SUFDckIsSUFBSSxVQUFpRCxDQUFDO0lBQ3RELElBQUksU0FBK0MsQ0FBQztJQUVwRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsT0FBTyxHQUFHLElBQUksaUJBQU8sRUFBRSxDQUFDO1FBQ3hCLFNBQVMsR0FBRyxJQUFJLEtBQU0sU0FBUSxxQkFBUztZQUF2Qjs7Z0JBQ2QsWUFBTyxHQUFHLEVBQUUsQ0FBQztZQUdmLENBQUM7U0FBQSxDQUFDO1FBQ0YsVUFBVSxHQUFHLElBQUksS0FBTSxTQUFRLHVCQUFVO1lBQXhCOztnQkFDZixZQUFPLEdBQUcsRUFBRSxDQUFDO1lBRWYsQ0FBQztTQUFBLENBQUM7SUFDSixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7UUFFMUIsYUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsYUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUMsYUFBTSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFN0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBRXhCLE9BQU8sQ0FBQyxHQUFHLENBQUMs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RTtZQUNwQyxhQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QyxPQUFPLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3hCLGFBQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLENBQUMsQ0FBQyxDQUFDO0lBRUwsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1hZXN0cm8gfSBmcm9tICcuLi8uLi9kaXN0L21hZXN0cm8vTWFlc3Rybyc7XHJcbmltcG9ydCB7IGV4cGVjdCB9IGZyb20gJ2NoYWknO1xyXG5pbXBvcnQgeyBDb250YWluZXIgfSBmcm9tICcuLi8uLi9kaXN0L2NvbnRhaW5lci9Db250YWluZXInO1xyXG5pbXBvcnQgeyBDb250cm9sbGVyIH0gZnJvbSAnLi4vLi4vZGlzdC9jb250cm9sbGVyL0NvbnRyb2xsZXInO1xyXG5pbXBvcnQgeyBJQWRhcHRlciB9IGZyb20gJy4uLy4uL2Rpc3QvYWRhcHRlci9JQWRhcHRlcic7XHJcbmltcG9ydCB7IE1vY2tlZEFkYXB0ZXIgfSBmcm9tICcuLi9tb2NrL2FkYXB0ZXIvTW9ja2VkQWRhcHRlcic7XHJcbmltcG9ydCB7IElQcm94aWVkUm91dGUgfSBmcm9tICcuLi8uLi9kaXN0L3Byb3h5L0lQcm94aWVkUm91dGUnO1xyXG5cclxuZGVzY3JpYmUoJ01hZXN0cm8nLCAoKSA9PiB7XHJcblxyXG4gIGxldCBtYWVzdHJvOiBNYWVzdHJvO1xyXG4gIGxldCBjb250cm9sbGVyOiBDb250cm9sbGVyICYgeyBbbmFtZTogc3RyaW5nXTogYW55OyB9O1xyXG4gIGxldCBjb250YWluZXI6IENvbnRhaW5lciAmIHsgW25hbWU6IHN0cmluZ106IGFueTsgfTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICBtYWVzdHJvID0gbmV3IE1hZXN0cm8oKTtcclxuICAgIGNvbnRhaW5lciA9IG5ldyBjbGFzcyBleHRlbmRzIENvbnRhaW5lciB7XHJcbiAgICAgIGJhc2VVUkwgPSAnJztcclxuICAgICAgW25hbWU6IHN0cmluZ106IGFueTtcclxuXHJcbiAgICB9O1xyXG4gICAgY29udHJvbGxlciA9IG5ldyBjbGFzcyBleHRlbmRzIENvbnRyb2xsZXIge1xyXG4gICAgICBiYXNlVVJMID0gJyc7XHJcbiAgICAgIFtuYW1lOiBzdHJpbmddOiBhbnk7XHJcbiAgICB9O1xyXG4gIH0pO1xyXG5cclxuICBpdCgnSXMgY3JlYXRlZCBlbXB0eScsICgpID0+IHtcclxuXHJcbiAgICBleHBlY3QobWFlc3Ryby5hbGxSb3V0ZXMoKS5sZW5ndGgpLmVxKDApO1xyXG4gICAgZXhwZWN0KG1hZXN0cm8uY29udGFpbmVycygpLmxlbmd0aCkuZXEoMCk7XHJcbiAgICBleHBlY3QobWFlc3Ryby5jb250cm9sbGVycygpLmxlbmd0aCkuZXEoMCk7XHJcblxyXG4gIH0pO1xyXG5cclxuICBpdCgnQWRkIGNvbnRhaW5lcnMnLCAoKSA9PiB7XHJcblxyXG4gICAgbWFlc3Ryby5hZGQoY29udGFpbmVyKTtcclxuICAgIGV4cGVjdChtYWVzdHJvLmNvbnRhaW5lcnMoKS5sZW5ndGgpLmVxKDEpO1xyXG5cclxuICB9KTtcclxuXHJcbiAgaXQoJ1JlbW92ZSBjb250YWluZXJzJywgKCkgPT4ge1xyXG5cclxuICAgIG1hZXN0cm8uYWRkKGNvbnRhaW5lcik7XHJcbiAgICBleHBlY3QobWFlc3Ryby5jb250YWluZXJzKCkubGVuZ3RoKS5lcSgxKTtcclxuXHJcbiAgICBtYWVzdHJvLnJlbW92ZUNoaWxkQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICBleHBlY3QobWFlc3Ryby5jb250YWluZXJzKCkubGVuZ3RoKS5lcSgwKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ0FkZCBjb250cm9sbGVycycsICgpID0+IHtcclxuXHJcbiAgICBtYWVzdHJvLmFkZChjb250cm9sbGVyKTtcclxuICAgIGV4cGVjdChtYWVzdHJvLmNvbnRyb2xsZXJzKCkubGVuZ3RoKS5lcSgxKTtcclxuXHJcbiAgfSk7XHJcblxyXG4gIGl0KCdSZW1vdmUgY29udHJvbGxlcnMnLCAoKSA9PiB7XHJcblxyXG4gICAgbWFlc3Ryby5hZGQoY29udHJvbGxlcik7XHJcbiAgICBleHBlY3QobWFlc3Ryby5jb250cm9sbGVycygpLmxlbmd0aCkuZXEoMSk7XHJcblxyXG4gICAgbWFlc3Ryby5yZW1vdmVDb250cm9sbGVyKGNvbnRyb2xsZXIpO1xyXG4gICAgZXhwZWN0KG1hZXN0cm8uY29udHJvbGxlcnMoKS5sZW5ndGgpLmVxKDApO1xyXG4gIH0pO1xyXG5cclxuICBpdCgnQWRkIGFkYXB0ZXJzJywgKCkgPT4ge1xyXG5cclxuICAgIGNvbnN0IGFkYXB0ZXI6IElBZGFwdGVyID0gbmV3IE1vY2tlZEFkYXB0ZXI7XHJcblxyXG4gICAgbWFlc3Ryby5hZGRBZGFwdGVyKGFkYXB0ZXIpO1xyXG5cclxuICAgIGV4cGVjdChPYmplY3QudmFsdWVzKG1hZXN0cm8uYWRhcHRlcnMpLmxlbmd0aCkuZXEoMSk7XHJcbiAgfSk7XHJcblxyXG4gIGl0KCdSZW1vdmUgYWRhcHRlcnMnLCAoKSA9PiB7XHJcbiAgICBjb25zdCBhZGFwdGVyOiBJQWRhcHRlciA9IG5ldyBNb2NrZWRBZGFwdGVyO1xyXG5cclxuICAgIG1hZXN0cm8uYWRkQWRhcHRlcihhZGFwdGVyKTtcclxuICAgIGV4cGVjdChPYmplY3QudmFsdWVzKG1hZXN0cm8uYWRhcHRlcnMpLmxlbmd0aCkuZXEoMSk7XHJcblxyXG4gICAgZGVsZXRlIG1hZXN0cm8uYWRhcHRlcnNbYWRhcHRlci5uYW1lXTtcclxuXHJcbiAgICBleHBlY3QoT2JqZWN0LnZhbHVlcyhtYWVzdHJvLmFkYXB0ZXJzKS5sZW5ndGgpLmVxKDApO1xyXG5cclxuICB9KTtcclxuXHJcbiAgaXQoJ0luaGVyaXQgcm91dGVzIGZyb20gY29udGFpbmVyJywgKCkgPT4ge1xyXG5cclxuICAgIGNvbnRyb2xsZXIucmVzb2x2ZSA9ICgpID0+IHsgfTtcclxuICAgIGNvbnRhaW5lci5hbGxSb3V0ZXMgPSAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJvdXRlczogSVByb3hpZWRSb3V0ZVtdID0gW3tcclxuICAgICAgICB1cmw6ICdtb2NrJyxcclxuICAgICAgICBtZXRob2RzOiAnZ2V0JyxcclxuICAgICAgICBjb250cm9sbGVyLFxyXG4gICAgICAgIHJlc29sdmVyOiBjb250cm9sbGVyLnJlc29sdmUsXHJcbiAgICAgICAgcmVxdWVzdFByb3hpZXM6IFtdLFxyXG4gICAgICAgIHJlc3BvbnNlUHJveGllczogW11cclxuICAgICAgfV07XHJcblxyXG4gICAgICByZXR1cm4gcm91dGVzO1xyXG4gICAgfVxyXG5cclxuICAgIG1hZXN0cm8udXNlKGNvbnRhaW5lcik7XHJcblxyXG4gICAgZXhwZWN0KG1hZXN0cm8uYWxsUm91dGVzKCkubGVuZ3RoKS5lcSgxKTtcclxuICB9KTtcclxuXHJcbiAgaXQoJ0luaGVyaXQgcm91dGVzIGZyb20gY29udHJvbGxlcicsICgpID0+IHtcclxuXHJcbiAgICBjb250cm9sbGVyLnJlc29sdmUgPSAoKSA9PiB7IH07XHJcbiAgICBjb250cm9sbGVyLmFsbFJvdXRlcyA9ICgpID0+IHtcclxuICAgICAgY29uc3Qgcm91dGVzOiBJUHJveGllZFJvdXRlW10gPSBbe1xyXG4gICAgICAgIHVybDogJ21vY2snLFxyXG4gICAgICAgIG1ldGhvZHM6ICdnZXQnLFxyXG4gICAgICAgIGNvbnRyb2xsZXIsXHJcbiAgICAgICAgcmVzb2x2ZXI6IGNvbnRyb2xsZXIucmVzb2x2ZSxcclxuICAgICAgICByZXF1ZXN0UHJveGllczogW10sXHJcbiAgICAgICAgcmVzcG9uc2VQcm94aWVzOiBbXVxyXG4gICAgICB9XTtcclxuXHJcbiAgICAgIHJldHVybiByb3V0ZXM7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQnkgaW5oZXJpdGluZyBmcm9tIGNvbnRhaW5lclxyXG4gICAgaXQoJ2luZGlyZWN0bHkgZnJvbSBjb250YWluZXInLCAoKSA9PiB7XHJcbiAgICAgIGNvbnRhaW5lci5hZGRDb250cm9sbGVyKGNvbnRyb2xsZXIpO1xyXG4gICAgICBtYWVzdHJvLnVzZShjb250YWluZXIpO1xyXG4gICAgICBleHBlY3QobWFlc3Ryby5hbGxSb3V0ZXMoKS5sZW5ndGgpLmVxKDEpO1xyXG4gICAgICBtYWVzdHJvLnJlbW92ZUNoaWxkQ29udGFpbmVyKGNvbnRhaW5lcik7XHJcbiAgICAgIG1hZXN0cm8uZGVsZXRlQ2FjaGVkUm91dGVzKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBCeSBkaXJlY3RsaW5nIGFkZGluZyBpdFxyXG4gICAgaXQoJ2RpcmVjdGx5IGFkZGluZyB0byBtYWVzdHJvJywgKCkgPT4ge1xyXG4gICAgICBleHBlY3QobWFlc3Ryby5hbGxSb3V0ZXMoKS5sZW5ndGgpLmVxKDApO1xyXG4gICAgICBtYWVzdHJvLmRlbGV0ZUNhY2hlZFJvdXRlcygpO1xyXG4gICAgICBtYWVzdHJvLnVzZShjb250cm9sbGVyKTtcclxuICAgICAgZXhwZWN0KG1hZXN0cm8uYWxsUm91dGVzKCkubGVuZ3RoKS5lcSgxKTtcclxuICAgIH0pO1xyXG5cclxuICB9KTtcclxufSk7Il19